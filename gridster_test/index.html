<!DOCTYPE html>
<html>
	<head>
		<title>gridster test</title>
		<meta name="author" content="gyurisc">
		<link rel="stylesheet" type="text/css" href="assets/css/jquery.gridster.css">
		<link rel="stylesheet" type="text/css" href="assets/css/styles.css">
		<title>Rotten Tomatoes Movies</title>
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="../sorting.js"></script>
		<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
	    <script src="//code.jquery.com/jquery-1.9.1.js"></script>
	    <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
		<style type="text/css">
			body {
				margin:0px;
				padding:0px;
				background-color: #004756;
			}

			svg {
				border: solid black 1px;
			}

			form {
				float : left;
			}

			#menu_container {
				width:100%;
				margin:0px;
				background-color: rgb(79, 137, 139);
				position:fixed;
				top:0px;
				overflow:visible;
				z-index: 999;
			}

			#menu {
				width:1000px;
				height:34px;
				background-color: rgb(79, 137, 139);
				padding:12px;
				margin-left:auto;
				margin-right:auto;
				overflow:visible;
			}

			#grid {
				/*position: relative;
				margin-left: 500px;
				margin-top: -250px;*/


			}

			#info{
				/*position: relative;
				margin-left: 0px;
				margin-top: -450px;*/


			}


			.button {
				padding: 0px 15px;
			    margin: auto;
			    float:left;
			    width:106px;
			    overflow:visible;
			    height:50px;
			}

			ul.filemenu {
			    margin:0; 
			    padding:0; 
			    list-style:none;
			}

			ul.hover {
				margin:0px;
				padding:0px;
				margin-right: 30px;
				font-size: 12px;
			}

			.menu_class {
			    border: 1px solid #394E4C;
				border-radius: 2px;
			}

			.file_menu {
			    display:none;
			    width:106px;
			    border: 1px solid #1c1c1c;
			    padding:0px;
			    margin:0px;
			}

			.file_menu li {
			    background-color: #ECECEC;
			    margin:0; 
			    padding:3px; 
			    list-style:none;
			    color:#000;
			    border-bottom:1px solid #DCDCDC;
			}

			.file_menu li:hover {
			    background-color: #79D3CF;
			}

			.file_menu li a {
			    color:#FFFFFF; 
			    text-decoration:none; 
			    padding:10px; 
			    display:block;
			}

			.file_menu li a:hover {
			    padding:10px;
			    font-weight:bold;
			    color: #F00880;
			}

			#select_years {
				width: 86px;
				text-align:center;
				padding:10px;
			}

			.genres, .criteria {
				width:186px!important;
			}

			.criteria li {
				width:180px!important;
			}

			.genres li {
				width:180px!important;
			}

			#select_genres {
				width: 166px!important;
				text-align:center;
				padding:10px;
			}

			#select_ratings {
				width: 86px;
				text-align:center;
				padding:10px;
			}

			#select_sort {
				width: 86px!important;
				text-align:center;
				padding:10px;
			}

			#select_criteria {
				width: 160px!important;
				text-align:center;
				padding:10px;
			}

			.hover li {
				width:100px;
			}

			.button.right {
				float:right;
			}

			.button_div {
				background-color: rgb(200, 209, 209);
				color: #FFF;
				font-size: 15px;
				font-weight: bold;
			}

			input {
				display:none;
			}

		</style>

		<!--New imports for d3 grids-->
		<script src="../d3-grid.js"></script>
		
	</head>
	<body>
		<div id="ahart">
		<section class="demo">
			<div class="gridster">
				<ul id="gridsta">
				</ul>
			</div>
		</section>
	</div>
		<!--Start HTML from me-->
	<div id="menu_container">
		<div id="menu">

			<div class="button">
			    <ul class="hover">
			       <li class="hoverli">
						<div id="select_years" width="184" height="32" class="menu_class button_div" />Years</div>
				        <ul class="file_menu">
					        <li><input id="seven" type="checkbox" name="year" value="2007">2007<br/></li>
							<li><input id="eight" type="checkbox" name="year" value="2008">2008<br/></li>
							<li><input id="nine" type="checkbox" name="year" value="2009">2009<br/></li>
							<li><input id="ten" type="checkbox" name="year" value="2010">2010<br/></li>
							<li><input id="eleven" type="checkbox" name="year" value="80s">2011<br/></li>
							<li><input id="twelve" type="checkbox" name="year" value="90s">2012<br/></li>
							<li><input id="thirteen" type="checkbox" name="year" value="2ks">2013<br/></li>
				        </ul>
			     	</li>
				</ul>
			</div>

			<div class="button genres">
			    <ul class="hover genres">
			       <li class="hoverli genres">
						<div id="select_genres" width="184" height="32" class="menu_class button_div" />Genres</div>
				        <ul class="file_menu genres">
					        <li><input id="action" type="checkbox" name="genre" value="action">Action & Adventure<br/></li>
							<li><input id="animation" type="checkbox" name="genre" value="animation">Animation<br/></li>
							<li><input id="arthouse" type="checkbox" name="genre" value="comedy">Art House & International<br/></li>
							<li><input id="classics" type="checkbox" name="genre" value="comedy">Classics<br/></li>
							<li><input id="comedy" type="checkbox" name="genre" value="comedy">Comedy<br/></li>
							<li><input id="documentary" type="checkbox" name="genre" value="romantic">Documentary<br/></li>
							<li><input id="drama" type="checkbox" name="genre" value="comedy">Drama<br/></li>
							<li><input id="horror" type="checkbox" name="genre" value="horror">Horror<br/></li>
							<li><input id="kids" type="checkbox" name="genre" value="kids">Kids & Family<br/></li>
							<li><input id="musical" type="checkbox" name="genre" value="horror">Musical & Performing Arts<br/></li>
							<li><input id="mystery" type="checkbox" name="genre" value="comedy">Mystery & Suspense<br/></li>
							<li><input id="romance" type="checkbox" name="genre" value="romantic">Romance<br/></li>
							<li><input id="scifi" type="checkbox" name="genre" value="romantic">Science Fiction & Fantasy<br/></li>
							<li><input id="special" type="checkbox" name="genre" value="horror">Special Interests<br/></li>
							<li><input id="sports" type="checkbox" name="genre" value="horror">Sports & Fitness<br/></li>
							<li><input id="tv" type="checkbox" name="genre" value="horror">Television<br/></li>
							<li><input id="western" type="checkbox" name="genre" value="horror">Western<br/></li>
				        </ul>
			     	</li>
				</ul>
			</div>

			<div class="button">
			    <ul class="hover">
			       <li class="hoverli">
						<div id="select_ratings" width="184" height="32" class="menu_class button_div" />Ratings</div>
				        <ul class="file_menu">
					        <li><input id="G" type="checkbox" name="year" value="2007">G<br/></li>
							<li><input id="PG" type="checkbox" name="year" value="2008">PG<br/></li>
							<li><input id="PG-13" type="checkbox" name="year" value="2009">PG-13<br/></li>
							<li><input id="R" type="checkbox" name="year" value="2010">R<br/></li>
							<li><input id="NC-17" type="checkbox" name="year" value="80s">NC-17<br/></li>
				        </ul>
			     	</li>
				</ul>
			</div>

			<div class="button right criteria">
			    <ul class="hover criteria">
			       <li class="hoverli criteria">
						<div id="select_criteria" width="184" height="32" class="menu_class button_div" />Criteria</div>
				        <ul class="file_menu criteria">
					        <li><input id="openingweekendtheaters" type="radio" name="char" value="rating">Number of Theaters In Opening Weekend<br/></li>
							<li><input id="worldwide" type="radio" name="char" value="rating">Worldwide Gross Profit<br/></li>
							<li><input id="openingweekend" type="radio" name="char" value="rating">Opening Weekend Revenue<br/></li>
							<li><input id="audience" type="radio" name="char" value="rating">Audience Score<br/></li>
							<li><input id="market" type="radio" name="char" value="rating">Market Profitability<br/></li>
							<li><input id="boxofficeavg" type="radio" name="char" value="rating">Box Office Average Revenue Opening Weekend<br/></li>
							<li><input id="budget" type="radio" name="char" value="rating">Budget<br/></li>
							<li><input id="foreigngross" type="radio" name="char" value="rating">Foreign Gross Profit<br/></li>
							<li><input id="critics" type="radio" name="char" value="rating">Critics Score<br/></li>
							<li><input id="domesticgross" type="radio" name="char" value="rating">Domestic Gross Profit<br/></li>
				        </ul>
			     	</li>
				</ul>
			</div>

			<div class="button right">
			    <ul class="hover">
			       <li class="hoverli">
						<div id="select_sort" width="184" height="32" class="menu_class button_div" />Sort By</div>
				        <ul class="file_menu order">
					        <li><input id="one" type="radio" name="char" value="rating">Lowest<br/></li>
							<li><input id="zero" type="radio" name="char" value="rating">Highest<br/></li>
				        </ul>
			     	</li>
				</ul>
			</div>
		</div>
	</div>

		<div id="grid"></div>
		<div id="info"></div>

		<script type="text/javascript" src="assets/jquery.js"></script>
		<script type="text/javascript" src="assets/jquery.gridster.js" charster="utf-8"></script>
		<script type="text/javascript">
			var gridster;
			var checkTime = 0;

			// for the scroll down menus
			$(document).ready(function () {
			    $(".hoverli").hover(
				  function () {
				     $(this).children().eq(1).slideDown('medium');
				  }, 
				  function () {
				     $(this).children().eq(1).slideUp('medium');
				  }
				);
			});

			$(function() {
				$(".gridster ul").gridster({
					widget_margins: [10, 10], 
					widget_base_dimensions: [140, 140]
				});
			});

			$(function() {
				gridster = $(".gridster ul").gridster().data('gridster');
				//console.log(gridster.serialize());
			})

			function removeWidget() {
				gridster.remove_widget( $(".gridster ul"));
			}

			var movies = [];

			//User preferences 
			var multSelectors = [];
			var singleCharacteristic;
			var years = [];
			var genres = [];
			var ratings = [];
			var highLow;
			var numMovies = 9;

			//movie data holders
			var moviesID = new Array();
  			var posters = new Array();
 			var posterImages;
  			var postersID = [];
  			var relevant;

  			function renderData() {


				var possRow = [1,2,3,4];
				var possCol = [1,2];

				if ($(".gridster li").length > 0) {
					$("#ahart").remove();
					$("#firstForm").prepend("<div id='ahart'><section class='demo'><div class='gridster'><ul id='gridsta'></ul></div></section></div>");
				}


				if (relevant.data != null && relevant.data != []) {
					$(".gridster ul").gridster({
						widget_margins: [10, 10], 
						widget_base_dimensions: [140, 140]
					});

					gridster = $(".gridster ul").gridster().data('gridster');

					$.each(relevant.data, function(i){
						var myRow = possRow[Math.floor(Math.random() * possRow.length)];
						var myCol = possCol[Math.floor(Math.random() * possCol.length)];
						gridster.add_widget('<li class="new"><img width="100%" height="100%" src="../posters/'+relevant.data[i].id+'/full.jpg"/></li>', myCol, myRow);
					});
				}
			}

  			//function for getting data
			//Hit JSON Data with years and characteristic!
			function retrieveData() {
				$.getJSON("../data.json", function(data){
				// global variable (from sorting.js) to store all movies.
				movies = data;

				if(years.length > 0 && singleCharacteristic != "" && (highLow == 0 || highLow == 1)){
					/* console.log("CALL:");
					console.log(years);
					console.log(genres);
					console.log(ratings);
					console.log(singleCharacteristic);
					console.log(highLow); */
					relevant = get_data(years, genres, ratings, singleCharacteristic, highLow);
				} else {
					relevant = {'data' : [], 'unused' : []};
				}
				
				// DO ALL D3 STUFF HERE
				if(relevant != undefined){
					posters = [];
					postersID = [];

					$.each(relevant.data, function(i) {
				          posters.push(relevant.data[i].Images["detailed"]);
				          postersID.push({id: relevant.data[i].id, posters:relevant.data[i].Images["detailed"]});
			        });

				    renderData();
				}
			});

			}


			//Multiple selector possibilities 
			d3.selectAll('.file_menu li').on("click", function(val){
				var checkbox = $(this).children().first();
				var parent = $(this).parent();
				if (parent.hasClass("criteria") || parent.hasClass("order")) { // criteria or order
					var siblings = $(this).siblings();
					if (parent.hasClass("criteria")) {
						siblings.css("background-color","#ECECEC");
					} else {
						siblings.css("background-color","#ECECEC");
					}
					$(this).unbind('mouseover mouseout');
					siblings.mouseover(function() { $(this).css("background-color","#79D3CF"); });
					siblings.mouseout(function() { $(this).css("background-color","#ECECEC"); });
					checkbox.prop('checked', true);
					$(this).css('background-color','rgb(90, 176, 178)');
				} else {
					if (checkbox.prop('checked') == false) {
						checkbox.prop('checked', true);
						$(this).unbind('mouseover mouseout');
						$(this).css('background-color','rgb(90, 176, 178)');
					} else {
						checkbox.prop('checked', false);
						$(this).css('background-color','#ECECEC');
						$(this).mouseover(function() { $(this).css("background-color","#79D3CF"); });
						$(this).mouseout(function() { $(this).css("background-color","#ECECEC"); });
					}
				}

				var checked = d3.selectAll('input');
				var counter = 0;


				multSelectors = [];
				singleCharacteristic = [];
				years = [];
				genres = [];
				ratings = [];

				checked[0].forEach(function(check){

					//FIX THIS
					if(d3.select("#"+check.id).property('checked') == true){
						if(check.id == "openingweekendtheaters"){
							$("#select_criteria").css("background-color","rgb(0, 42, 51)");
							singleCharacteristic = "Number_of_Theatres_in_Opening_Weekend";
						} else if(check.id == "worldwide"){
							$("#select_criteria").css("background-color","rgb(0, 42, 51)");
							singleCharacteristic = "Worldwide";
						} else if(check.id == "openingweekend"){
							$("#select_criteria").css("background-color","rgb(0, 42, 51)");
							singleCharacteristic = "Opening_Weekend";
						} else if(check.id == "audience"){
							$("#select_criteria").css("background-color","rgb(0, 42, 51)");
							singleCharacteristic = "Audience_Score";
						} else if(check.id == "market"){
							$("#select_criteria").css("background-color","rgb(0, 42, 51)");
							singleCharacteristic = "Market_Profitability";
						} else if(check.id == "boxofficeavg"){
							$("#select_criteria").css("background-color","rgb(0, 42, 51)");
							singleCharacteristic = "Box_Office_Avg_Opening_Wknd";
						} else if(check.id == "budget"){
							$("#select_criteria").css("background-color","rgb(0, 42, 51)");
							singleCharacteristic = "Budget";
						} else if(check.id == "foreigngross"){
							$("#select_criteria").css("background-color","rgb(0, 42, 51)");
							singleCharacteristic = "Foreign_Gross";
						} else if(check.id == "critics"){
							$("#select_criteria").css("background-color","rgb(0, 42, 51)");
							singleCharacteristic = "Critics_Score";
						} else if(check.id == "domesticgross"){
							$("#select_criteria").css("background-color","rgb(0, 42, 51)");
							singleCharacteristic = "Domestic_Gross";
						} else if(check.id == "zero"){
							$("#select_sort").css("background-color","#004756");
							highLow = Order.high;
						} else if(check.id == "one"){
							$("#select_sort").css("background-color","#004756");
							highLow = Order.low;
						} else {
							multSelectors.push(check);
						};
					};
				});



				multSelectors.forEach( function(select){

					if(select.id == "seven"){
						years.push(2007);
					} else if (select.id == "eight"){
						years.push(2008);
					} else if (select.id == "nine"){
						years.push(2009);
					} else if (select.id == "ten"){
						years.push(2010);
					} else if (select.id == "eleven"){
						years.push(2011);
					} else if (select.id == "twelve"){
						years.push(2012);
					} else if (select.id == "thirteen"){
						years.push(2013);
					} else if (select.id == "action"){
						genres.push("Action & Adventure");
					} else if (select.id == "animation"){
						genres.push("Animation");
					} else if (select.id == "arthouse"){
						genres.push("Art House & International");
					} else if (select.id == "classics"){
						genres.push("Classics");
					} else if (select.id == "comedy"){
						genres.push("Comedy");
					} else if (select.id == "documentary"){
						genres.push("Documentary");
					} else if (select.id == "drama"){
						genres.push("Drama");
					} else if (select.id == "horror"){
						genres.push("Horror");
					} else if (select.id == "kids"){
						genres.push("Kids & Family");
					} else if (select.id == "musical"){
						genres.push("Musical & Performing Arts");
					} else if (select.id == "mystery"){
						genres.push("Mystery & Suspense");
					} else if (select.id == "romance"){
						genres.push("Romance");
					} else if (select.id == "scifi"){
						genres.push("Science Fiction & Fantasy");
					} else if (select.id == "special"){
						genres.push("Special Interests");
					} else if (select.id == "sports"){
						genres.push("Sports & Fitness")
					} else if (select.id == "tv"){
						genres.push("Television");
					} else if (select.id == "western"){
						genres.push("Western");
					} else {
						ratings.push(select.id);
					}
				});

				if (years.length == 0) {
					$("#select_years").css("background-color","rgb(200, 209, 209)");
				} else {
					$("#select_years").css("background-color","#004756");
				}

				if (genres.length == 0) {
					$("#select_genres").css("background-color","rgb(200, 209, 209)");
				} else {
					$("#select_genres").css("background-color","#004756");
				}

				if (ratings.length == 0) {
					$("#select_ratings").css("background-color","rgb(200, 209, 209)");
				} else {
					$("#select_ratings").css("background-color","#004756");
				}
				
				retrieveData();

			});


		</script>
	</body>
</html>